<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Finished Goods Traceability</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <script>var plEnvironment = (window.location.href && window.location.href.indexOf("localhost")>=0)
        ? ' localhost'
        : (window.location.href && window.location.href.indexOf("-dev.pharmaledger.")>=0)
        ? ' DEV'
        : '';
        document.title = document.title + plEnvironment;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="center-aligned-controls vertical-align">

        <a class="wallet-login dsu-fabric_button scale-up" href="fgt-mah-wallet/loader/" target="_blank" style="display: none;">
            <div class="left-side">
                <img src="assets/images/factory.png" alt="MAH-app">
            </div>
            <div class="right-side">
                <p>MAH wallet</p>
            </div>
        </a>

        <a class="wallet-login leaflet-wallet_button scale-up" href="fgt-wholesaler-wallet/loader/" target="_blank" style="display: none;">
            <div class="left-side">
                <img src="assets/images/wholesaler.png" alt="Wholesaler-App">
            </div>
            <div class="right-side">
                <p>Wholesaler Wallet</p>
            </div>
        </a>

        <a class="wallet-login web-wallet_button scale-up" href="fgt-pharmacy-wallet/loader" target="_blank" style="display: none;">
            <div class="left-side">
                <img src="assets/images/pharmacy.png" alt="Pharmacy-App">
            </div>
            <div class="right-side">
                <p>Pharmacy Wallet</p>
            </div>
        </a>

        <a id="swagger" class="dsu-fabric_button scale-up" href="swagger.localhost:8080" target="_blank" style="display:none">
            <div class="left-side">
                <img src="assets/images/factory.png" alt="swagger">
            </div>
            <div class="right-side">
                <p>Swagger Instance</p>
            </div>
            <script>
                const swaggerButton = document.body.querySelector(`#swagger`);
                if (window.location.hostname.match(/[-\.]?(?:mah|whs|pha)[\-\d]/g)){
                    const isLocalhost = window.location.hostname.endsWith('localhost');
                    swaggerButton.setAttribute("style", "display: block;");
                    swaggerButton.setAttribute("href", `${isLocalhost ? 'http://' : 'https://'}swagger-${window.location.host}`);
                }
            </script>
        </a>

        <a id="dashboard" class="dsu-fabric_button scale-up" href="./dashboard" target="_blank">
            <div class="left-side">
                <img src="assets/images/factory.png" alt="swagger">
            </div>
            <div class="right-side">
                <p>Dashboard</p>
            </div>
<!--            <script>-->
<!--                const dashboardButton = document.body.querySelector(`#dashboard`);-->
<!--                if (window.location.hostname.match(/[-\.]?(?:mah|whs|pha)[\-\d]/g)){-->
<!--                    const isLocalhost = window.location.hostname.endsWith('localhost');-->
<!--                    dashboardButton.setAttribute("style", "display: block;");-->
<!--                    dashboardButton.setAttribute("href", `${isLocalhost ? 'http://' : 'https://'}swagger-${window.location.host}`);-->
<!--                }-->
<!--            </script>-->
        </a>

        <a class="web-wallet_button scale-up" href="dsu-explorer/loader/" target="_blank">
            <div class="left-side">
                <img src="assets/images/cube.png" alt="DSU-Explorer">
            </div>
            <div class="right-side">
                <p>DSU Explorer</p>
            </div>
        </a>

        <a id="epirus" class="web-wallet_button scale-up" href="https://fgt-epirus-dev.pharmaledger.pdmfc.com/" target="_blank" style="display: none;">
            <div class="left-side">
                <img src="assets/images/cube.png" alt="Ethereum-Explorer">
            </div>
            <div class="right-side">
                <p>Ethereum Explorer</p>
            </div>
        </a>
        <script>
            var activateEpirusButton = function () {
                const epirusAnchor = document.body.querySelector('a[id="epirus"]');
                const url = window.location.hostname;

                if (url.match(/[-\.]?(?:mah|whs|pha)[\-\d]/g)){
                    epirusAnchor.setAttribute("style", "display: none;");
                } else {
                    if (url.endsWith('localhost')) {
                        epirusAnchor.setAttribute('href', `http://localhost:8700`);
                    } else if (url.includes('fgt-dev.pharmaledger')) {
                        epirusAnchor.setAttribute('href', `https://fgt-epirus-dev.pharmaledger.pdmfc.com`);
                    } else if (url.includes('fgt.pharmaledger')) {
                        epirusAnchor.setAttribute('href', `https://fgt-epirus-tst.pharmaledger.pdmfc.com`);
                    }
                    epirusAnchor.setAttribute("style", "display: block;");
                };
            };
            activateEpirusButton();
        </script>

    </div>
    <div>
        <h1><img src="assets/images/pharmaledgerLogo.png" alt="Pharmaledger" style="height: 2em; vertical-align: middle; margin-right: 1em;">Finished Goods Traceability
            Demo<script>document.write(plEnvironment);</script></h1>

        <p>Demonstration of order and shipment management, mapping traceability of every lot (batch) using blockchain - through
            <a href="http://opendsu.com" target="_blank">OpenDSU</a> technology.</p>

        <p>The Rest API Running on each server, capable of being integrated with each Participant's ERP system,
            handles all the logic and automatically broadcasts the appropriate information is that every company (MAH, Wholesaler,
            Pharmacy) according to need to know basis.
            This ensures that each company operates as usual as they already do today.</p>

        <div id="traceability" style="display:block;">
            <h3>Traceability workspace</h3>
            <p>This is the 'traceability' domain workspace. All DSU anchoring under the traceability domain happens here. You can use the DSu Explorer to inspect any DSUs</p>
            <p>Below are the links to each participant's workspace:
                <ul>
                    <li>
                        MAH:
                        <ul>
                            <li><a class="participant" href="mah-pfizer" target="_blank">Pfizer</a></li>
                            <li><a class="participant" href="mah-roche" target="_blank">Roche</a></li>
                            <li><a class="participant" href="mah-msd" target="_blank">MSD</a></li>
                            <li><a class="participant" href="mah-gsk" target="_blank">GSK</a></li>
                            <li><a class="participant" href="mah-bayer" target="_blank">Bayer</a></li>
                            <li><a class="participant" href="mah-novo-nordisk" target="_blank">Novo Nordisk</a></li>
                            <li><a class="participant" href="mah-takeda" target="_blank">Takeda (Mock MAH)</a></li>
                            <li><a class="participant" href="mah-sanofi" target="_blank">Sanofi</a></li>
                        </ul>
                    </li>
                    <li>
                        Wholesalers:
                        <ul>
                            <li><a class="participant" href="whs-takeda" target="_blank">Takeda</a></li>
                            <li><a class="participant" href="whs1" target="_blank">Wholesaler 1</a></li>
                            <li><a class="participant" href="whs2" target="_blank">Wholesaler 2</a></li>
                        </ul>
                    </li>
                    <li>
                        Pharmacies:
                        <ul>
                            <li><a class="participant" href="pha1" target="_blank">Pharmacy 1</a></li>
                            <li><a class="participant" href="pha2" target="_blank">Pharmacy 2</a></li>
                        </ul>
                    </li>
                </ul>
            </p>
            <script>
                const traceabilityDiv = document.body.querySelector('div[id="traceability"]');
                const url = window.location.hostname;

                if (url.match(/[-\.]?(?:mah|whs|pha)[\-\d]/g)){
                    traceabilityDiv.setAttribute("style", "display: none;");
                } else {
                    const lis = traceabilityDiv.querySelectorAll('.participant');
                    const isLocalhost = url.endsWith('localhost');
                    const isRoot = !url.startsWith('traceability')
                    lis.forEach(l => {
                        const name = l.getAttribute('href');
                        const host = window.location.host;
                        const newLink = `${isLocalhost ? 'http://' : 'https://'}${name}${isLocalhost ? '.'  : '-'}${!isRoot ? host.substring('traceability.'.length) : host}`
                        l.setAttribute('href', `${newLink}`)
                    })
                }
            </script>
        </div>

        <div id="participant" style="display:none;">
            <h3><a id="participant-name">Participant</a> Workspace</h3>
            <script>
                const participantName = document.body.querySelector(`a[id="participant-name"]`);
                const url2 = window.location.hostname;
                if (url2.match(/[-\.]?(?:mah|whs|pha)[\-\d]/g)){
                    const regexp = /[-\.]?(mah|whs|pha)[\-\.]?(\d+|\w+)[\-\.]/g;
                    const match = regexp.exec(url2);
                    participantName.innerHTML = `${match[1].toUpperCase()} - ${(match[2] || '').toUpperCase()}${(match[3] || '').toUpperCase()}`;
                }
            </script>
            <p>
                <ul>
                    <li>
                       Click the Swagger button to access your swagger dashboard. There you can find:
                        <ul>
                            <li>The address the Finished Goods Traceability REST API is running under (this address can be used to test your own ERP integrations);</li>
                            <li>A complete description of all the operations available to your ERP and the JSOn objects they receive/produce;</li>
                            <li>A way to manually interact with the REST API via the 'try' button in each endpoint;</li>
                        </ul>
                    </li>
                    <li>For most operations (create, update, etc) the successful return outputs a KeySSI. You can use DSU Explorer to inspect these DSUs;</li>
                    <li>
                        <p>The sequence diagram illustrating the provisioning products and batches (commissioning) is as follows:</p>
                        <div class="mermaid">
                            sequenceDiagram
                            participant s as MAH
                            participant r as Wholesalers and Pharmacies
                            activate s
                            s->>s: /product/create
                            s->>s: /batch/create
                            note left of s: Batches are created in <br /> the commissioned status<br /> and are ready to ship.
                            alt Shipment sequence details
                            note over s , r: Shipment sequence described elsewhere.
                            end
                            s->>s: /batch/update
                            s-->>r: Automatically sends messages to other<br />actors involved with this specific batch.
                        </div>
                    </li>
                    <li>
                        <p>The state diagram for batch status update is as follows:</p>
                        <div class="mermaid">
                            graph LR
                            A(.) -->|/batch/create| B(commissioned)
                            B -->|/batch/update| C(quarantined)
                            C -.->|/batch/update| B
                            C -->|/batch/update| D((recall))
                            B -->|/batch/update| D

                            classDef green fill:#9f6,stroke:#333,stroke-width:2px;
                            classDef yellow fill:#FEDE00,stroke:#333,stroke-width:2px;
                            classDef red fill:#ff5349,stroke#333,stroke-width:2px;

                            class B green
                            class C yellow
                            class D red
                        </div>
                    </li>
                    <li>
                        <p>The sequence diagram for the shipping operation is as follows:</p>
                        <p>
                            <div class="mermaid">
                                sequenceDiagram
                                participant s as Sender
                                participant r as Receiver
                                activate s
                                s->>s: /shipment/create
                                note left of s: OrderId can be anything
                                note left of s: Sender can see shipment with status 'created'.<br>Sender stock has been reduced
                                s-->>r: Sends Message to Receiver<br>with Shipment Info
                                note right of r: Receiver can now see shipment in incoming shipments
                                alt sad path
                                note over s , r: Shipment Held
                                s->>s: /shipment/update<br />Update status to 'hold'
                                s-->>r: Sends Message to Receiver<br>with status update notice
                                note right of r: Receiver can see shipment has been held (and the reason for it)
                                alt Shipment Released
                                s->>s: /shipment/update<br />Update status to previous status
                                s-->>r: Sends Message to Receiver<br>with status update notice
                                note right of r: Receiver can now see updated status incoming shipments
                                end
                                alt Shipment Rejected
                                note over s , r: Shipment Rejected
                                s->>s: /shipment/update<br />Update status to 'reject'
                                s-->>r: Sends Message to Receiver<br>with status update notice
                                note right of r: Receiver can now see rejected shipment (and why)
                                end
                                end
                                alt happy path
                                note over s , r: Shipment is sent
                                s->>s: /shipment/update<br />Update status to 'pickup'
                                s-->>r: Sends Message to Receiver<br>with status update notice
                                note right of r: Receiver can now see updated status incoming shipments
                                s->>s: /shipment/update<br />Update status to 'transit'
                                s-->>r: Sends Message to Receiver<br>with status update notice
                                note right of r: Receiver can now see shipment is in transit
                                loop while in transit
                                s->>s: /shipment/update<br />Update status to 'transit' with added information
                                s-->>r: Sends Message to Receiver<br>with status update notice
                                note right of r: Receiver can now see shipment the additional information that has been added
                                end
                                s->>s: /shipment/update<br />Update status to 'delivered'
                                s-->>r: Sends Message to Receiver<br>with status update notice
                                note right of r: Receiver can now see shipment has been delivered
                                deactivate s
                                activate r
                                r->>r: /shipment/update<br />Update status to 'received'
                                r-->>s: Sends Message to Sender<br>with status update notice
                                note left of s: Receiver can now see shipment has been delivered
                                r->>r: /shipment/update<br />Update status to 'confirmed'
                                r-->>s: Sends Message to Sender<br>with status update notice
                                note left of s: Receiver can now see shipment has been confirmed
                                note right of r: Receiver can now see his updated stock
                                deactivate r
                                end
                            </div>
                        </p>
                    </li>
                    <li>
                        <p>The state diagram for a shipment is as follows:</p>
                        <p>Sender:
                            <div class="mermaid">
                                graph LR
                                A[Sender] -->|creates Shipment| B(created)
                                B --> D((reject))
                                B --> E(hold)
                                E --> D
                                E -.-> B
                                B --> F(pickup)
                                F --> D
                                F --> E
                                E -.-> F
                                F --> G(transit)
                                G --> D
                                G --> E
                                E -.-> G
                                G --> H(delivered)
                                H --> D
                                H --> E
                                E -.-> H

                                classDef green fill:#9f6,stroke:#333,stroke-width:2px;
                                classDef yellow fill:#FEDE00,stroke:#333,stroke-width:2px;
                                classDef red fill:#ff5349,stroke#333,stroke-width:2px;

                                class B,F,G,H green
                                class D,K red
                                class E,L yellow
                            </div>
                        </p>
                        <p>Receiver:
                            <div class="mermaid">
                                graph LR
                                I[Receiver] --> |receives Shipment| J(delivered)
                                J --> K((reject))
                                J --> L(hold)
                                L --> K
                                L -.-> J
                                J --> M(received)
                                M --> K
                                M --> L
                                L -.-> M
                                M --> N((confirmed))

                                classDef green fill:#9f6,stroke:#333,stroke-width:2px;
                                classDef yellow fill:#FEDE00,stroke:#333,stroke-width:2px;
                                classDef red fill:#ff5349,stroke#333,stroke-width:2px;

                                class J,M,N green
                                class K red
                                class L yellow
                            </div>
                        </p>
                    </li>
                    <li>
                        <p>Sales can only be performed by Pharmacies:</p>
                        <div class="mermaid">
                            sequenceDiagram
                            participant s as MAH
                            participant r as Pharmacy
                            activate s
                            r->>r: /sale/create<br />with gtin, batch and serial number
                            r-->>s: Sends message to MAH of product notifying the sale of an individual product.
                        </div>
                    </li>
                    <li>
                        <p>Traceability information requests can be created at any participant in the chain:</p>
                        <div class="mermaid">
                            sequenceDiagram
                            participant s as Participant
                            activate s
                            s->>s: /traceability/create<br />with gtin and batch
                        </div>
                    </li>
                </ul>
            </p>
            <script>
                const participantDiv = document.body.querySelector(`div[id="participant"]`);
                if (window.location.hostname.match(/[-\.]?(?:mah|whs|pha)[\-\d]/g))
                    participantDiv.setAttribute("style", "display: block;");
            </script>
        </div>

        <div id="credentials" style="display: none;">
            <p>Below are the necessary credentials to login with some pre-generated data:</p>
            <ul>
                <li>MAH<ul>
                    <li>Randomly pre-generated products each with pre-generated batches (including serialNumbers);</li>
                </ul></li>
                <li>Wholesaler<ul>
                    <li>2 randomly generated orders from the Pharmacy;</li>
                </ul></li>
                <li>Pharmacy<ul>
                    <li>2 randomly generated orders to the wholesaler (based on the products from the MAH);</li>
                </ul></li>
            </ul>
            <p>For each participant change only the <span style="font-weight: bold;">Id</span>. All the other credentials remain the same.</p>
            <p>To view the contents of each Participant SSApp, use the <span style="font-weight: bold;">Id</span> to LOGIN, and the keySSI to explore DSU details in the <img src="assets/images/cube.png" style="height: 1em;"><a href="/dsu-explorer/loader/" target="_blank">DSU Explorer</a> (using +Add, Receive Dossier, choosing a name for it, and then "Enter Dossier SEED" to enter the keySSI). (Note that keySSIs are <span style="font-weight: bold;">private secrets</span>, unless you share them.)</p>
            <table id="credentials-table" style="width: 100%;">
                <tr>
                    <th></th>
                    <th>Marketing Authorization Holder</th>
                    <th>Wholesaler</th>
                    <th>Pharmacy</th>
                </tr>
                <tr>
                    <th>Id</th>
                    <td style="border-style: solid;" id="id-mah"></td>
                    <td style="border-style: solid;" id="id-whs"></td>
                    <td style="border-style: solid;" id="id-pha"></td>
                </tr>
                <tr style="word-break: break-all;">
                    <th>KeySSI</th>
                    <td style="border-style: solid;" id="key-mah"></td>
                    <td style="border-style: solid;" id="key-whs"></td>
                    <td style="border-style: solid;" id="key-pha"></td>
                </tr>
            </table>
        </div>

<!--        <p>For using other than the provided credentials, you are free to register/login as any on the Participants, but all the data will have to filled out manually</p>-->

        <p><span style="font-weight: bold;">WARNING:</span> Unstable software and environments. Use at your own risk! Data persistence at risk of unexpected reset!</p>

        <h2>v0.8.7 Release Notes 2022-04-XX</h2>
        <h4>Rest API:</h4>
        <ul>
            <li>Added shipmentId as optional field  to create a shipment;</li>
            <li>Added auto generated serial numbers when not provided to create a batch (limited to 10,000);</li>
            <li>Added authentication;</li>
            <li>Updated and improved the Swagger docs.</li>
        </ul>

        <h2>v0.8.6 Release Notes 2022-04-07</h2>
        <p>Added Sanofi as an MAH for demonstration purposes.</p>

        <h2>v0.8.5 Release Notes 2022-03-29</h2>
        <h4>Blockchain integration:</h4>
        <p>Fixing DSU Explorer by upgrading psk-release to 2022-03-28 and ethAdapter to 2022-03-29 versions.</p>

        <h2>v0.8.4 Release Notes 2022-03-18</h2>
        <h4>Blockchain integration:</h4>
        <ul>
            <li>Integration with <a href="https://github.com/PharmaLedger-IMI/blockchain-node-workspace">blockchain-node-workspace</a> v0.3.0 using an experimental ethadapter and quorumengineering/quorum:21.7.1</li>
            <li>OpenDSU technology stack upgraded to <a href="https://github.com/PrivateSky/psk-release/tree/e98392eff7fd268409e642a4f5f1c995ffd5f9de">psk-release 2022-March-08</a>.</li>
        </ul>

        <h2>v0.8.3 Release Notes 2022-03-16</h2>
        <h4>Rest API:</h4>
        <ul>
            <li>Added sequence diagram exposing the status update steps for creating products and batches, and traceability requests. Added state diagrams for batch status. OpenAPI (Swagger) documentation on some replies fixed.</li>
        </ul>
    
        <h2>v0.8.2 Release Notes 2022-03-09</h2>
        <h4>Rest API:</h4>
        <ul>
            <li>Added Sequence diagram exposing the status update steps for a shipment on the participants workspaces;</li>
            <li>Fixed the traceability response and the product status after sale;</li>
            <li>Added shipmentLines endpoint to MAH;</li>
            <li>Updated shipment id generator to format: <i>{senderId}-{requesterId}-{orderId}-{randomId};</i></li>
        </ul>

        <h2>v0.8.1 Release Notes 2022-03-03</h2>
        <h4>Rest API:</h4>
        <ul>
            <li>Improved data validation on insertion;</li>
            <li>Improved error response with more accurate HTTP codes and description;</li>
            <li>Added more tests;</li>
            <li>Allow the sellers to query receipts (for now, the functionality is only available if the MAH is available to receive messages);</li>
            <li>Improved API/Swagger to request less fields on requests/routes:</li>
            <ul>
                <li>/shipment: removed status and senderId as required field to insert data (and shipmentLine updated to inherit it);</li>
                <li>/sale: removed sellerId and manufName as required field to insert data;</li>
            </ul>
        </ul>

        <h2>v0.8.0 Release Notes 2022-02-17</h2>
        <p>Migration to a REST API implementation, meant to integrate with any ERP (There should be no more concurrency conflicts from having multiple wallets with the same id opened);</p>
        <p>Creation and deployment of a fully configured Swagger instance for each environment. This allows for both testing the functionality in real time, but also as a guide for ERP integration;</p>
        <p>DID communication upgrade to using the latest DID method provided by OpenDSU.</p>
        <p>Deployment of a test environment, simulation a real life scenario, where every participant has its own environment and can interact with the REST API:
        <ul>
            <li>
                <p>Real World Infrastructure Architecture:</p>
                <p>Each participant has its own environment, with integrated FGT REST API and ERP systems. Some run Traceability blockchain nodes (MAHs) as well as their own domains;</p>
                <p><image src="https://pharmaledger-imi.github.io/fgt-workspace/resources/drawings/finishedGoodsTraceabilityDSUTypes-fgt-api-deployment.png"></image></p>
            </li>
            <li>
                <p>Test Infrastructure Architecture:</p>
                <p>Each participant has its own (simulated) environment, with integrated FGT REST API and 'ERP Dashboard' (the endpoint can bu used to actually integrate with ERPs).</p>
                <p><image src="https://pharmaledger-imi.github.io/fgt-workspace/resources/drawings/finishedGoodsTraceabilityDSUTypes-fgt-api-test-deployment.png"></image></p>
            </li>
        </ul>
        </p>

        <h2>v0.7.4 Release Notes 2021-11-25</h2>
        <p>Performance and stability improvements.</p>

        <h2>v0.7.3 Release Notes 2021-11-22</h2>
        <p>Dashboard page updated with Most Sold Product, Stock & Shipments Status charts. For now, some functionalities are limited.</p>
        <p>Notification System Update:
            <ul>
                <li>Created the Notification Page on the Wholesaler and Pharmacy Wallets</li>
                <li>Implemented badges which display the number of unseen notifications on the stock tab button</li>
            </ul>
        </p>
        <p>Stock Manager bug fixed where the stock was not being properly updated upon shipment confirmation</p>        

        <h2>v0.7.2 Release Notes 2021-11-05</h2>
        <p>Updated Status component to properly display history and extra info on end states;</p>
        <p>Updated Loader no longer pre-cache icons before allowing login;</p>

        <h2>v0.7.1 Release Notes 2021-11-04</h2>
        <p>Improved Status component to properly display history and extra info;</p>

        <h2>v0.7.0 Release Notes 2021-10-28</h2>
        <p>Implemented the batch recall functionality:
            <ul>
                <li>MAH's, in the Batch Screen, now have the option to update the batch status (supported statuses: 'COMMISSIONED', 'QUARANTINED' and 'RECALLED');</li>
                <li>Batch status updates are automatically transmitted to all participants (Pharmacies and Wholesalers) that have stock with that product - batch combination in stock;</li>
                <li>All participants that are notified of a batch status update, automatically update their stock info;</li>
            </ul>
        </p>
        <p>Implemented batch traceability visualization for wholesalers and pharmacies via their Stock screen;</p>
        <p>Improved DSU and Database access performance for 'true blockchain' integration;</p>
        <p>Implemented a Database locking mechanism to properly handle concurrent writing;</p>
        <p>Tested (successfully) the implementation and deployment mechanism in a 'true blockchain' environment;</p>
        <p>Several performance improvements and bug fixes;</p>

        <h2>v0.6.2 Release notes 2021-09-10</h2>
        <p>New Actors included in the Test Scenarios (GSK and Takeda) - Test Scenarios (<a href="https://upm365.sharepoint.com/sites/PharmaLedger/_layouts/15/Doc.aspx?OR=teams&action=edit&sourcedoc={9D0DED0A-E1F9-4A51-808D-D07E71CC5CF0}" target="_blank">Test Scenarios</a> and <a href="https://upm365.sharepoint.com/sites/PharmaLedger/_layouts/15/Doc.aspx?OR=teams&action=edit&sourcedoc={0BCB2A99-4E8D-4038-9988-9D9BFEAD1F76}" target="_blank">User Guide</a>);
            <ul>
                <li>For the Specific Case of Takeda, a 'Mock' MAH was created, with dummy products;</li>
                <li>The Pharmacy now makes 2 orders originally:
                    <ul>
                        <li>One Order with all non 'Takeda' products, made to the generic wholesaler that then relays that order to all non 'Takeda' MAHs;</li>
                        <li>One Order will all 'Takeda' products, made to the Takeda Wholesaler that then relays to order to the 'Takeda' MAH;</li>
                    </ul>
                </li>
            </ul>
        </p>
        <p>Shipment and Order Status Updates now allow inputting additional data;</p>
        <p>Corrected Address for Novo Nordisk, it is now 'Bagsvaerd, Denmark';</p>
        <p>Small UI improvements;</p>
        <p>Minor bug fixes;</p>

        <h2>v0.6.1 Release notes 2021-09-05</h2>
        <p>Test Scenarios for MVP1 implemented (5 MAHs, 1 Wholesaler, 1 Pharmacy - Credentials above) - Test Scenarios (<a href="https://upm365.sharepoint.com/sites/PharmaLedger/_layouts/15/Doc.aspx?OR=teams&action=edit&sourcedoc={9D0DED0A-E1F9-4A51-808D-D07E71CC5CF0}" target="_blank">Test Scenarios</a> and <a href="https://upm365.sharepoint.com/sites/PharmaLedger/_layouts/15/Doc.aspx?OR=teams&action=edit&sourcedoc={0BCB2A99-4E8D-4038-9988-9D9BFEAD1F76}" target="_blank">User Guide</a>);</p>
        <p>Shipment and Order communication fully implemented along with theirs respective status updates;</p>
        <p>Sale events are also transmitted to each Product's MAH and registered on a Sale DSU;</p>
        <p>Supply chain calculation as a service by the MAH implemented (accessible via the MAH's recept screen of the Pharmacy's sales screen);</p>
        <p>Supply chain communication implemented;</p>
        <p>Minor bug fixes;</p>

        <h2>v0.4.0 Release notes 2021-07-09</h2>

        <p>Shipment creation and status updates are propagated to the requester (as received shipments and an update to the order);</p>
        <p>Minor bug fixes;</p>

        <h3>Test Script</h3>
        <h5>Browser</h5>
        <ul>
            <li>Open an MAH Wallet, and log in. (This ensures that there is an active listener for messages sent to the MAH). Leave that tab open and proceed with the script.</li>
            <li>Open an Wholesale Wallet, and log in ; Go to the "Orders Received" and there are some pre-created orders (from Pharmacies) available. ; For any of those orders, click the "clockwork wheel" ; A "CREATE SHIPMENT" screen appears. Click on the "ORDER MISSING", and it jumps to a "CREATE ORDER" screen ; On the "CREATE ORDER" screen, select the pre-existing MAHID, and then press "ISSUED ORDER +", and "CONFIRM".</li>
            <li>Go the MAH Wallet tab previously opened; Go to the "Orders", and the order just created from the Wholesaler should be visible. ; For that specific order, click the "Cogwheel" ; A "CREATE SHIPMENT" screen appears ; Click on "CONFIRM ALL AVAILABLE", and then click on the "CREATE +", and "CONFIRM".</li>
            <li>Still in the MAH Wallet, go to 'Shipment Lines'. The ShipmentLines referring the the newly created shipments should be listed;</li>
            <li>Return to Wholesale Wallet click "Shipments" => "Incoming Shipments"; you should find the recently created incoming shipment displayed in the list; Click "Orders" => "Issued Orders" you should see a 'train' button in the recently created Order. The order is now linked to the shipment. Click the "Eye" button; Its status should have changed to 'ACKNOWLEDGED';</li>
            <li>Return to the MAH Wallet, go to 'Shipments' and click on the "Cogwheel" for the recently created shipment; Click "MARK AS 'FOR PICKUP'" and confirm. This will update the shipment status</li>
            <li>Go back to the Wholesaler Wallet, click "Orders" => "Issued Orders" and the "Eye" button for the created Order; The status of the order should have changed to "FOR PICKUP";</li>
        </ul>

        <h2>v0.3.3 Release notes 2021-06-29</h2>

        <p>Adds the possibility to add requesters/senders to the directory (allowing to choose newly created wallets as targets for orders/shipments);</p>
        <p>The limitation of not being able to create a shipment without an order, exists solely because without an order and without eGovernance,
            we have no way of knowing the destination address, which is mandatory for a shipment in the existing Data Model
            (and required for all user stories that include 'time until delivery' estimation). This limitation would not exist in a real product because all the information would be provided by the participants ERP systems.</p>

        <h2>v0.3.1 Release notes 2021-06-28</h2>

        <p>Technological architecture refactoring (using ionic components) complete;</p>
        <p>Re-Design according to PharmaLedger's Style rules complete;</p>
        <p>Communication between Participant Wallets achieved;</p>
        <p>Creation and transmission of orders complete;</p>
        <p>Creation and transmission of shipments complete;</p>
        <p>Creation and transmission of orderLines complete - deprecated - will be removed for the next release;</p>
        <p>Creation and transmission of shipmentLines complete;</p>
        <p>Auto Instantiation of Participant Wallets with dummy data complete (we await proper 'real' data to start recreating a proper business environment);</p>

        <h3>Upcoming developments for the next release:</h3>
        <p>Order And Shipment status update;</p>
        <p>Final product state implementation (ADMINISTERED);</p>
        <p>Traceability on the batch level after product is in final state;</p>
        <p>Implicit stock evaluation for all chain of custody participants by the MAH for their products;</p>

        <p>Milestones achieved on this release, compared to the plan 2021-01-20_ImplementationPlanMVPFinishedGoodsTraceability.docx:</p>
        <ul>
            <li>M1 OpenDSU Solution Concept Complete - 100% - PDM's Architecture concept/Framework complete and stable.</li>
            <li>M2 Development Environment Setup Complete - complete 100% - development environment available at <a href="https://fgt-dev.pharmaledger.pdmfc.com/">https://fgt-dev.pharmaledger.pdmfc.com/</a>. (Data persistence and other configuration tasks still in progress).</li>
            <li>M3 Business Test Environment Setup Complete - complete 100% - environment available at <a href="https://fgt.pharmaledger.pdmfc.com/">https://fgt.pharmaledger.pdmfc.com/</a>. (Data persistence and other configuration tasks still in progress).</li>
        </ul>

        <p>Known bugs:</p>
        <ul>
            <li>Login page does not present input fields: Happens rarely, refresh the browser. Will be handled next version;</li>
            <li>Order/Shipment screens fail to load directory (suppliers, requesters): Happens occasionally, refresh the browser and re-login. Will be handled next version;</li>
            <li>Other issues (still in development, not considered bugs):
                <ul>
                    <li>Some buttons are enabled when they shouldn't be and clicking them (without the necessary preconditions) will throw an error. eg: Create a shipment with products not confirmed or that you have no stock for;</li>
                    <li>Some screens still allows for 'illegal actions': eg: a 'Manage issued shipment' screen will still allow adding products, which it shouldn't;</li>
                </ul>
            </li>
            <li>Communication between participants is sometimes ignored the receiving Application is not running. (Will be fixed next release)</li>
        </ul>

        <h2>v0.2.1 Release notes 2021-05-03</h2>

        <p>Technological architecture refactoring (using ionic components). Data preloading instructions soon.</p>

        <h2>Release notes 2021-03-26</h2>

        <p>Application description / testing instructions</p>
        <ul>
            <li><img src="assets/images/factory.png" style="height: 1em;"> MAH (Marketing Authorization Holder) App:
                <ol>
                    <li>On the first usage, you need to register a username password to open the wallet. (Re-used from ePi)</li>
                    <li>On the first opening of the wallet, you need to register details of a MAH company. <b>Only a single user is supported for that company at this version.</b></li>
                    <li>After these 2 initial register steps (which will be merged into one), you may create Products (new GTINs) and create Batches (commission new product batches).</li>
                </ol>
            </li>
            <li><img src="assets/images/wholesaler.png" style="height: 1em;"> Wholesaler Wallet - experimenting new graphical layout and registration process.</li>
            <li><img src="assets/images/pharmacy.png" style="height: 1em;"> Pharmacy Wallet:
                <ol>
                    <li>Same initial 2 registration steps as in the MAH app.</li>
                    <li>After these 2 initial register steps (which will be merged into one), you may create orders for Products.</li>
                </ol>
            </li>
            <li><img src="assets/images/cube.png" style="height: 1em;"> DSU Explorer - debug tool to explore DSUs anchored on the blockchain (Re-used from ePi).</li>
        </ul>
        Wallets do not communicate yet, so nothing done on one wallet is visible on other wallets.

        <p>Milestones achieved on this release, compared to the plan 2021-01-20_ImplementationPlanMVPFinishedGoodsTraceability.docx:</p>
        <ul>
            <li>M1 OpenDSU Solution Concept Complete - partial 50% - work in progress in DSU constitution and attributes.</li>
            <li>M2 Development Environment Setup Complete - complete 80% - development environment available at <a href="https://fgt-dev.pharmaledger.pdmfc.com/">https://fgt-dev.pharmaledger.pdmfc.com/</a>. (Data persistence and other configuration tasks still in progress).</li>
            <li>M3 Business Test Environment Setup Complete - complete 80% - environment available at <a href="https://fgt.pharmaledger.pdmfc.com/">https://fgt.pharmaledger.pdmfc.com/</a>. (Data persistence and other configuration tasks still in progress).</li>
        </ul>

        <p>PDM welcomes technical contributions at <a href="https://github.com/PharmaLedger-IMI/fgt-workspace">https://github.com/PharmaLedger-IMI/fgt-workspace</a></p>
    </div>
    <footer>
        <img src="assets/images/eu-h337.png" alt="EU" align="left" style="height: 6em; margin: 0.5em;">
        <br>
        This project has received funding from the European Unionâ€™s Horizon 2020 research and innovation programme under grant agreement No 853992
        <br>&nbsp;<br>
        v<!-- VERSION_START -->0.8.7-g745e3f39<!-- VERSION_END --> &copy;&nbsp;2021 <a href="http://pharmaledger.eu">Pharmaledger.eu</a> - All Rights Reserved.
    </footer>

    <script type="application/javascript">

        const displayCredentials = function(credentials){
            const byWallet = credentials.reduce((accum, cred) => {
                accum[cred.type] = accum[cred.type] || [];
                accum[cred.type].push(...cred.created);
                return accum;
            }, {});

            if (!credentials.find(c => c.type ==='fgt-mah-wallet').created.every(c => c.name)){
                document.getElementById('id-mah').innerText = byWallet['fgt-mah-wallet'][0].id;
                document.getElementById('id-whs').innerText = byWallet['fgt-wholesaler-wallet'][0].id;
                document.getElementById('id-pha').innerText = byWallet['fgt-pharmacy-wallet'][0].id;

                document.getElementById('key-mah').innerText = byWallet['fgt-mah-wallet'][0].ssi;
                document.getElementById('key-whs').innerText = byWallet['fgt-wholesaler-wallet'][0].ssi;
                document.getElementById('key-pha').innerText = byWallet['fgt-pharmacy-wallet'][0].ssi;

                document.getElementById('credentials').style.display = "block";
            } else {

                const getParticipant = function(credentials, needOpenTr = false){
                    return `
        ${needOpenTr ? '<tr>' : ''}
        <td style="border-style: solid;">${credentials.name}</td>
        <td style="border-style: solid;">${credentials.id}</td>
        <td style="border-style: solid;">${credentials.email}</td>
        <td style="border-style: solid;">${credentials.address}</td>
        </tr>
        <tr>
        <th style="border-style: solid;">KeySSI:</th>
        <td style="border-style: solid;" colspan="3">${credentials.ssi}</td>
        </tr>
                    `
                }

                const getCategory = function(category, credentials){
                    return `
        <tr>
        <th style="border-style: solid;" rowspan=${2 * credentials.created.length}>${credentials.type}</th>
        ${credentials.created.map((c, i) => getParticipant(c, i !== 0)).join('\n')}
        `
                };

                const getHeader = function(){
                    return `
<tr>
    <th>Wallet</th>
    <th>Name</th>
    <th>Id</th>
    <th>Email</th>
    <th>Address</th>
</tr>
`;
                }

                document.getElementById('credentials-table').innerHTML = `\
                ${getHeader()}
                ${Object.keys(credentials).map(key => getCategory(key, credentials[key])).join('\n')}
                `
                document.getElementById('credentials').style.display = "block";

                document.body.querySelectorAll('.wallet-login').forEach(e => e.setAttribute('style', "display: block;"))

            }
        }

        const getCredentials = function(){
                const credentialsFile = new XMLHttpRequest();
                credentialsFile.open("GET", './credentials.json', true);
                credentialsFile.send();
                credentialsFile.onreadystatechange = function() {
                    if (credentialsFile.readyState === 4 && credentialsFile.status === 200)
                        displayCredentials(JSON.parse(credentialsFile.responseText));
                }
            }

        getCredentials();
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>

</html>
